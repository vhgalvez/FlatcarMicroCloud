ğŸ§© FlatcarMicroCloud â€” Arquitectura K3s HA sobre KVM

                 ğŸ–¥ï¸ Host fÃ­sico: 192.168.0.40 (Rocky Linux + KVM/libvirt)
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚          Interfaces fÃ­sicas + br0 (LAN bridge)     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                      â”‚
          ğŸ”„ LoadBalancer 1                       ğŸ” LoadBalancer 2
     (192.168.0.11 - HAProxy + Keepalived)   (192.168.0.12 - HAProxy + Keepalived)
               â”‚                                      â”‚
               â””â”€â”€â”€â”€â”€â”€ VIP: 192.168.0.10/6443 (API) â”€â”€â”˜
                       VIP: 192.168.0.14/80-443 (Web)

                                 â”‚
                    ğŸ”„ RedirecciÃ³n desde router fÃ­sico
                    [8080 â†’ 192.168.0.14:80]
                    [2052 â†’ 192.168.0.14:443]

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                         ğŸŒ Red LAN: 192.168.0.0/24                         â”‚
â”‚                                                                            â”‚
â”‚ infra-cluster: 192.168.0.30 â†’ CoreDNS + Chrony                             â”‚
â”‚                                                                            â”‚

â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚              ğŸ” Redes NAT Internas (libvirt): Seguridad y aislamiento      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ§± 10.17.3.0/24 â€” Infraestructura base                                     â”‚
â”‚    â””â”€ postgresql1: 10.17.3.14 â†’ Base de datos                              â”‚
â”‚    â””â”€ infra-cluster (si replica roles DNS/NTP)                             â”‚
â”‚    â””â”€ PostgreSQL dedicado, microservicios, etc.                           â”‚
â”‚                                                                            â”‚
â”‚ â˜¸ï¸ 10.17.4.0/24 â€” ClÃºster Kubernetes (K3s HA)                              â”‚
â”‚    â”œâ”€ Masters:   10.17.4.21â€“23 (etcd + control-plane)                      â”‚
â”‚    â”œâ”€ Workers:   10.17.4.24â€“26 (aplicaciones)                              â”‚
â”‚    â””â”€ Storage:   10.17.4.27     (NFS + Longhorn)                           â”‚
â”‚                                                                                       â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ğŸ”’ Seguridad y Accesos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ğŸ” VPN (WireGuard): acceso seguro a la red privada desde VPS o cliente
- ğŸ” HAProxy + Keepalived: balanceo + failover de API y Web
- ğŸ”¥ nftables: firewall en host fÃ­sico
    - Solo permite trÃ¡fico desde VPN/LAN
    - Bloquea acceso directo a API Kubernetes desde Internet

ğŸŒ Acceso externo
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- La API de Kubernetes (6443) solo es accesible por VPN o LAN
- El trÃ¡fico web (Traefik, apps) entra por 8080 y 2052 al VIP 192.168.0.14

ğŸ§  Ventajas del diseÃ±o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ›¡ï¸  Seguridad fuerte         â€” API no expuesta + firewall + VPN
ğŸ”„  Alta disponibilidad      â€” HA con etcd, HAProxy, Keepalived
ğŸ§©  Modular y escalable      â€” AÃ±adir nodos fÃ¡cilmente
ğŸ”Œ  Redes separadas          â€” Mejor aislamiento y rendimiento
ğŸ§ª  SimulaciÃ³n realista      â€” Entorno tipo producciÃ³n en casa
ğŸ”§  AutomatizaciÃ³n lista     â€” Soporte para Ansible + Terraform
